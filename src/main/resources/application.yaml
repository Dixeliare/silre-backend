spring:
  application:
    name: silre-backend
  
  # Database Configuration
  # ⚠️ Production: Use environment variables or external config
  # Format: ${ENV_VAR:default_value} - Uses env var if available, otherwise uses default
  datasource:
    driver-class-name: org.postgresql.Driver
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
  
  # Redis Configuration (Default - can be overridden by profiles)
  # Enterprise: Use Redis Cluster/Sentinel for High Availability
  data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT}
      password: ${REDIS_PASSWORD:}  # Empty by default, set via env var
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
  
  jpa:
    hibernate:
      ddl-auto: validate # Không tạo schema, chỉ validate (vì dùng Flyway)
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        default_schema: public # Chỉ định schema mặc định
        format_sql: true

  threads:
    virtual:
      enabled: true
  
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    validate-on-migrate: true

# TSID Configuration (Enterprise-Grade)
# tsid.allow-dev-mode: false  # Set to true ONLY for local development without Redis
#                              # WARNING: NOT recommended for production - causes ID collisions in multi-instance deployments

# Spring Boot Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info  # Expose health endpoint for TSID monitoring
  endpoint:
    health:
      show-details: always  # Show details always (for development - change to 'when-authorized' in production)

# SpringDoc OpenAPI (Swagger) Configuration
# Swagger UI KHÔNG tự mở trình duyệt; chỉ lắng trên endpoint.
# Đây phù hợp với triết lý Spring Boot: ứng dụng backend không chủ động điều khiển UI máy người dùng.
springdoc:
  api-docs:
    path: /v3/api-docs  # JSON/YAML API docs endpoint
  swagger-ui:
    path: /swagger-ui.html  # Swagger UI endpoint
    enabled: true
    try-it-out-enabled: true  # Enable "Try it out" feature
    operations-sorter: method  # Sort operations by HTTP method
    tags-sorter: alpha  # Sort tags alphabetically
  show-actuator: true  # Show Actuator endpoints in Swagger
  packages-to-exclude: com.longdx.silre_backend.exception  # Exclude exception handlers from SpringDoc scanning (fixes compatibility issue with Spring Boot 4.0.1)

# JWT Configuration
# ⚠️ Production: Use environment variables or secret management service
# Minimum secret length: 32 characters (256 bits) for HS256 algorithm
jwt:
  secret: ${JWT_SECRET}
  issuer: ${JWT_ISSUER}
  access-token-expiration: ${JWT_ACCESS_TOKEN_EXPIRATION:900000}  # 15 minutes (milliseconds)
  refresh-token-expiration: ${JWT_REFRESH_TOKEN_EXPIRATION:604800000}  # 7 days (milliseconds)